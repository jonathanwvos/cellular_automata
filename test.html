<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Canvas Animation with FPS and Grid</title>
        <style>
            #controls {
                margin-bottom: 12px;
            }
            #myCanvas {
                border: 1px solid #ccc;
            }
        </style>
    </head>
    <body>
        <div id="controls">
            <label for="fpsRange">Frame Rate:</label>
            <input type="range" id="fpsRange" min="1" max="60" value="30" />
            <span id="fpsValue">30</span> FPS
        </div>

        <canvas id="myCanvas" width="900" height="900"></canvas>

        <script>
            // Get references to our DOM elements
            const canvas = document.getElementById("myCanvas");
            const ctx = canvas.getContext("2d");

            const fpsRange = document.getElementById("fpsRange");
            const fpsValue = document.getElementById("fpsValue");

            // Default frames per second
            let fps = parseInt(fpsRange.value);

            // Holds the setInterval reference
            let animationInterval = null;

            // This function updates the scene (e.g., positions of shapes, game logic, etc.)
            function update() {
                // Example logic: You can update positions of objects here
                // For demonstration, we're just going to draw random squares
            }

            // Draw a grid across the entire canvas
            function drawGrid() {
                const gridSize = 10; // adjust this to make bigger or smaller cells

                ctx.save();
                ctx.strokeStyle = "#888"; // change the color if you like
                ctx.lineWidth = 1;

                // Draw vertical grid lines
                for (let x = 0; x <= canvas.width; x += gridSize) {
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, canvas.height);
                    ctx.stroke();
                }

                // Draw horizontal grid lines
                for (let y = 0; y <= canvas.height; y += gridSize) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(canvas.width, y);
                    ctx.stroke();
                }

                ctx.restore();
            }

            // This function draws the content on the canvas
            function draw() {
                // Clear the canvas for each new frame
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Now draw the grid so that it overlays everything
                drawGrid();

                // Draw the random square
                ctx.fillStyle = "blue";
                const x = Math.round(Math.random() * (canvas.width - 10));
                const y = Math.round(Math.random() * (canvas.height - 10));
                console.log(x, y);
                ctx.fillRect(x, y, 10, 10);
            }

            // The main animation function which gets called each "frame"
            function animate() {
                update();
                draw();
            }

            // Start or restart the animation interval with the specified FPS
            function restartAnimation() {
                // Clear any existing interval
                if (animationInterval) {
                    clearInterval(animationInterval);
                }

                // Start the new animation loop at the desired FPS
                animationInterval = setInterval(() => {
                    animate();
                }, 1000 / fps);
            }

            // Listen for changes on the range input to update FPS
            fpsRange.addEventListener("input", () => {
                fps = parseInt(fpsRange.value);
                fpsValue.textContent = fps;
                restartAnimation(); // Restart animation at new FPS
            });

            // Kick off the initial animation
            restartAnimation();
        </script>
    </body>
</html>
